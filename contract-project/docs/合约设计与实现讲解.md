# BloomSocial æ™ºèƒ½åˆçº¦è®¾è®¡ä¸å®ç°è®²è§£

> æœ¬æ–‡æ¡£é¢å‘ Web3 å­¦å‘˜ï¼Œè¯¦ç»†è®²è§£ BloomSocial ç¤¾äº¤å¹³å°çš„æ™ºèƒ½åˆçº¦è®¾è®¡æ€è·¯å’Œå®ç°é€»è¾‘ã€‚

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [åˆçº¦æ¶æ„](#2-åˆçº¦æ¶æ„)
3. [BloomToken ä»£å¸åˆçº¦](#3-bloomtoken-ä»£å¸åˆçº¦)
4. [BloomContent æ ¸å¿ƒåˆçº¦](#4-bloomcontent-æ ¸å¿ƒåˆçº¦)
5. [WeightLib æƒé‡è®¡ç®—åº“](#5-weightlib-æƒé‡è®¡ç®—åº“)
6. [ç»æµæ¨¡å‹è¯¦è§£](#6-ç»æµæ¨¡å‹è¯¦è§£)
7. [å®Œæ•´æµç¨‹ç¤ºä¾‹](#7-å®Œæ•´æµç¨‹ç¤ºä¾‹)
8. [å®‰å…¨è€ƒè™‘](#8-å®‰å…¨è€ƒè™‘)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 BloomSocial æ˜¯ä»€ä¹ˆï¼Ÿ

BloomSocial æ˜¯ä¸€ä¸ª **å»ä¸­å¿ƒåŒ–å†…å®¹ç¤¾äº¤å¹³å°**ï¼Œæ ¸å¿ƒç†å¿µæ˜¯ï¼š

- **å†…å®¹åˆ›ä½œè€…**å‘å¸ƒå†…å®¹å¯ä»¥è·å¾—ç»æµå›æŠ¥
- **æ—©æœŸç‚¹èµè€…**è·å¾—æ›´é«˜çš„æ¿€åŠ±
- **å¹³å°**æ”¶å–å°‘é‡æ‰‹ç»­è´¹ç»´æŒè¿è¥

### 1.2 æ ¸å¿ƒç©æ³•

```
åˆ›ä½œè€…å‘å¸ƒå†…å®¹ â†’ ç”¨æˆ·ä»˜è´¹ç‚¹èµ â†’ åˆ°æœŸåå„æ–¹é¢†å–æ”¶ç›Š
```

### 1.3 åˆçº¦æ–‡ä»¶æ¸…å•

| åˆçº¦æ–‡ä»¶ | ä½œç”¨ |
|---------|------|
| `BloomToken.sol` | ERC-20 ä»£å¸ï¼Œå¹³å°ç»æµç³»ç»Ÿçš„åŸºç¡€è´§å¸ |
| `BloomContent.sol` | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šå†…å®¹ç®¡ç†ã€ç‚¹èµã€å¥–åŠ±åˆ†é… |
| `WeightLib.sol` | æƒé‡è®¡ç®—åº“ï¼Œå®ç°"æ—©é¸Ÿæ¿€åŠ±"æœºåˆ¶ |

---

## 2. åˆçº¦æ¶æ„

### 2.1 æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     ç”¨æˆ·/å‰ç«¯        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                   â”‚                   â”‚
           â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ åˆ›å»ºå†…å®¹      â”‚   â”‚ ç‚¹èµ         â”‚   â”‚ é¢†å–å¥–åŠ±     â”‚
    â”‚ createContent â”‚   â”‚ like         â”‚   â”‚ claimReward  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚                   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   BloomContent åˆçº¦  â”‚
                    â”‚   (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                   â”‚                   â”‚
           â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ BloomToken   â”‚   â”‚ WeightLib    â”‚   â”‚ OpenZeppelin â”‚
    â”‚ (ERC-20ä»£å¸) â”‚   â”‚ (æƒé‡è®¡ç®—)    â”‚   â”‚ (å®‰å…¨åº“)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¾èµ–å…³ç³»

```solidity
// BloomContent.sol çš„å¯¼å…¥
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";        // ä»£å¸æ¥å£
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // å®‰å…¨è½¬è´¦
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";       // é‡å…¥é˜²æŠ¤
import "./WeightLib.sol";                                          // æƒé‡è®¡ç®—
```

---

## 3. BloomToken ä»£å¸åˆçº¦

### 3.1 è®¾è®¡ç›®çš„

BloomToken æ˜¯å¹³å°çš„å”¯ä¸€äº¤æ˜“åª’ä»‹ï¼Œç”¨äºï¼š
- ç‚¹èµæ—¶æ”¯ä»˜ä»£å¸
- æ¥æ”¶åˆ›ä½œå¥–åŠ±
- æ¥æ”¶ç‚¹èµåˆ†çº¢

### 3.2 åˆçº¦ç»§æ‰¿

```solidity
contract BloomToken is ERC20, Ownable {
    // ERC20: æ ‡å‡†ä»£å¸åŠŸèƒ½ï¼ˆè½¬è´¦ã€æˆæƒç­‰ï¼‰
    // Ownable: ç®¡ç†å‘˜æƒé™æ§åˆ¶
}
```

### 3.3 æ ¸å¿ƒå¸¸é‡

```solidity
uint256 public constant INITIAL_SUPPLY = 1_000_000_000 * 10 ** 18; // 10äº¿ä»£å¸
uint256 public constant FAUCET_AMOUNT = 1000 * 10 ** 18;           // æ°´é¾™å¤´æ¯æ¬¡1000ä¸ª
uint256 public constant FAUCET_COOLDOWN = 1 days;                   // æ°´é¾™å¤´å†·å´1å¤©
```

### 3.4 æ„é€ å‡½æ•°

```solidity
constructor() ERC20("BloomToken", "BLOOM") Ownable(msg.sender) {
    _mint(msg.sender, INITIAL_SUPPLY);
}
```

**è§£è¯»ï¼š**
1. `ERC20("BloomToken", "BLOOM")` - è®¾ç½®ä»£å¸åç§°å’Œç¬¦å·
2. `Ownable(msg.sender)` - éƒ¨ç½²è€…æˆä¸ºåˆçº¦æ‰€æœ‰è€…
3. `_mint(msg.sender, INITIAL_SUPPLY)` - é“¸é€ 10äº¿ä»£å¸ç»™éƒ¨ç½²è€…

### 3.5 é“¸é€ å‡½æ•°ï¼ˆä»…æµ‹è¯•ç½‘ï¼‰

```solidity
function mint(address to, uint256 amount) external onlyOwner {
    _mint(to, amount);
}
```

**`onlyOwner` ä¿®é¥°ç¬¦**ï¼šåªæœ‰åˆçº¦æ‰€æœ‰è€…æ‰èƒ½è°ƒç”¨æ­¤å‡½æ•°ã€‚

### 3.6 æ°´é¾™å¤´å‡½æ•°

```solidity
mapping(address => uint256) public lastFaucetClaim;

function faucet() external {
    require(
        block.timestamp >= lastFaucetClaim[msg.sender] + FAUCET_COOLDOWN,
        "BloomToken: Faucet cooldown not elapsed"
    );
    lastFaucetClaim[msg.sender] = block.timestamp;
    _mint(msg.sender, FAUCET_AMOUNT);
}
```

**è®¾è®¡æ€è·¯ï¼š**
- æµ‹è¯•ç½‘ç”¨æˆ·å¯ä»¥å…è´¹é¢†å–ä»£å¸
- æ¯ä¸ªåœ°å€æ¯å¤©åªèƒ½é¢†å–ä¸€æ¬¡ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- ä½¿ç”¨ `mapping` è®°å½•æ¯ä¸ªåœ°å€çš„ä¸Šæ¬¡é¢†å–æ—¶é—´

---

## 4. BloomContent æ ¸å¿ƒåˆçº¦

### 4.1 è®¾è®¡ç›®çš„

è¿™æ˜¯å¹³å°çš„**æ ¸å¿ƒä¸šåŠ¡åˆçº¦**ï¼Œè´Ÿè´£ï¼š
- å†…å®¹çš„åˆ›å»ºå’Œç®¡ç†
- ç‚¹èµå’Œä»£å¸åˆ†é…
- å¥–åŠ±çš„è®¡ç®—å’Œé¢†å–
- ç¤¾äº¤å…³ç³»ï¼ˆå…³æ³¨åŠŸèƒ½ï¼‰

### 4.2 ç»æµæ¨¡å‹å¸¸é‡

```solidity
uint256 private constant BPS_DENOMINATOR = 10000;  // åŸºç‚¹åˆ†æ¯ï¼ˆç”¨äºç™¾åˆ†æ¯”è®¡ç®—ï¼‰
uint256 public constant AUTHOR_BPS = 7000;         // ä½œè€… 70%
uint256 public constant LIKER_BPS = 2500;          // ç‚¹èµè€… 25%
uint256 public constant PROTOCOL_BPS = 500;        // å¹³å° 5%
```

**ä»€ä¹ˆæ˜¯ BPSï¼ˆåŸºç‚¹ï¼‰ï¼Ÿ**
- BPS = Basis Points = ä¸‡åˆ†æ¯”
- 7000 BPS = 7000/10000 = 70%
- è¿™ç§æ–¹å¼é¿å…æµ®ç‚¹æ•°è®¡ç®—ï¼Œæ›´ç²¾ç¡®

### 4.3 æ•°æ®ç»“æ„

#### å†…å®¹ç»“æ„ä½“

```solidity
struct Content {
    address author;           // ä½œè€…åœ°å€
    uint256 likeAmount;       // ç‚¹èµä»·æ ¼ï¼ˆæ¯æ¬¡ç‚¹èµéœ€è¦å¤šå°‘ä»£å¸ï¼‰
    uint256 deadline;         // æˆªæ­¢æ—¶é—´
    uint256 authorPool;       // ä½œè€…å¥–é‡‘æ± 
    uint256 likerRewardPool;  // ç‚¹èµè€…å¥–é‡‘æ± 
    uint256 totalWeight;      // æ‰€æœ‰ç‚¹èµè€…æƒé‡ä¹‹å’Œ
    uint256 likeCount;        // ç‚¹èµæ•°é‡
    string contentURI;        // å†…å®¹é“¾æ¥ï¼ˆé€šå¸¸æ˜¯IPFSåœ°å€ï¼‰
    bytes32 contentHash;      // å†…å®¹å“ˆå¸Œï¼ˆç”¨äºéªŒè¯ï¼‰
    bool authorClaimed;       // ä½œè€…æ˜¯å¦å·²é¢†å–å¥–åŠ±
}
```

#### ç‚¹èµä¿¡æ¯ç»“æ„ä½“

```solidity
struct LikeInfo {
    uint256 likeIndex;  // ç‚¹èµé¡ºåºï¼ˆç¬¬å‡ ä¸ªç‚¹èµï¼‰
    uint256 weight;     // è¯¥ç‚¹èµçš„æƒé‡
    bool claimed;       // æ˜¯å¦å·²é¢†å–å¥–åŠ±
}
```

#### çŠ¶æ€æ˜ å°„

```solidity
mapping(uint256 => Content) public contents;                        // å†…å®¹ID => å†…å®¹
mapping(uint256 => mapping(address => LikeInfo)) public likes;      // å†…å®¹ID => ç”¨æˆ· => ç‚¹èµä¿¡æ¯
mapping(address => mapping(address => bool)) public isFollowing;    // å…³æ³¨å…³ç³»
```

### 4.4 åˆ›å»ºå†…å®¹

```solidity
function createContent(
    uint256 likeAmount,       // ç‚¹èµä»·æ ¼
    uint256 duration,         // æŒç»­æ—¶é•¿ï¼ˆç§’ï¼‰
    string calldata contentURI,  // å†…å®¹é“¾æ¥
    bytes32 contentHash       // å†…å®¹å“ˆå¸Œ
) external returns (uint256 contentId) {
    // å‚æ•°æ ¡éªŒ
    if (likeAmount == 0) revert InvalidLikeAmount();
    if (duration == 0) revert InvalidDuration();

    // ç”Ÿæˆå†…å®¹ID
    contentId = nextContentId++;

    // å­˜å‚¨å†…å®¹
    contents[contentId] = Content({
        author: msg.sender,
        likeAmount: likeAmount,
        deadline: block.timestamp + duration,  // å½“å‰æ—¶é—´ + æŒç»­æ—¶é•¿
        authorPool: 0,
        likerRewardPool: 0,
        totalWeight: 0,
        likeCount: 0,
        contentURI: contentURI,
        contentHash: contentHash,
        authorClaimed: false
    });

    // å‘å‡ºäº‹ä»¶ï¼ˆä¾¿äºå‰ç«¯ç›‘å¬ï¼‰
    emit ContentCreated(contentId, msg.sender, likeAmount, ...);
}
```

**è®¾è®¡è¦ç‚¹ï¼š**
1. å†…å®¹åˆ›å»ºæ˜¯**å…è´¹**çš„ï¼ˆä¸éœ€è¦è´¨æŠ¼ä»£å¸ï¼‰
2. ä½œè€…å¯ä»¥**è‡ªå®šä¹‰ç‚¹èµä»·æ ¼**
3. ä½¿ç”¨ `nextContentId++` è‡ªå¢ç”Ÿæˆå”¯ä¸€ID
4. `deadline` é™åˆ¶äº†å†…å®¹çš„æ´»è·ƒæœŸ

### 4.5 ç‚¹èµï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

```solidity
function like(uint256 contentId) external nonReentrant {
    Content storage content = contents[contentId];

    // æ ¡éªŒ
    if (content.author == address(0)) revert ContentNotFound();
    if (block.timestamp >= content.deadline) revert ContentExpired();
    if (likes[contentId][msg.sender].likeIndex != 0) revert AlreadyLiked();

    uint256 amount = content.likeAmount;

    // 1ï¸âƒ£ ä»ç”¨æˆ·è½¬ç§»ä»£å¸åˆ°åˆçº¦
    bloomToken.safeTransferFrom(msg.sender, address(this), amount);

    // 2ï¸âƒ£ è®¡ç®—å„æ–¹åˆ†æˆ
    uint256 authorAmount = (amount * AUTHOR_BPS) / BPS_DENOMINATOR;   // 70%
    uint256 likerAmount = (amount * LIKER_BPS) / BPS_DENOMINATOR;     // 25%
    uint256 protocolAmount = amount - authorAmount - likerAmount;      // 5%ï¼ˆç”¨å‡æ³•é¿å…ç²¾åº¦æŸå¤±ï¼‰

    // 3ï¸âƒ£ æ›´æ–°å¥–é‡‘æ± 
    content.authorPool += authorAmount;
    content.likerRewardPool += likerAmount;
    protocolFeeAccumulated += protocolAmount;

    // 4ï¸âƒ£ è®¡ç®—ç‚¹èµæƒé‡ï¼ˆæ—©æœŸç‚¹èµæƒé‡æ›´é«˜ï¼‰
    content.likeCount++;
    uint256 weight = WeightLib.calculateWeight(content.likeCount);
    content.totalWeight += weight;

    // 5ï¸âƒ£ è®°å½•ç‚¹èµä¿¡æ¯
    likes[contentId][msg.sender] = LikeInfo({
        likeIndex: content.likeCount,
        weight: weight,
        claimed: false
    });

    emit Liked(contentId, msg.sender, content.likeCount, weight, amount);
}
```

**ä»£ç æµç¨‹å›¾ï¼š**

```
ç”¨æˆ·è°ƒç”¨ like(contentId)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ ¡éªŒ                    â”‚
â”‚   - å†…å®¹å­˜åœ¨ï¼Ÿ             â”‚
â”‚   - æœªè¿‡æœŸï¼Ÿ               â”‚
â”‚   - æœªç‚¹èµè¿‡ï¼Ÿ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è½¬ç§»ä»£å¸                â”‚
â”‚   ç”¨æˆ· â”€â”€â†’ åˆçº¦            â”‚
â”‚   (éœ€è¦ç”¨æˆ·æå‰ approve)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åˆ†é…åˆ°å„å¥–é‡‘æ±           â”‚
â”‚   ä½œè€…æ± : 70%              â”‚
â”‚   ç‚¹èµæ± : 25%              â”‚
â”‚   åè®®è´¹: 5%               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è®¡ç®—æƒé‡                â”‚
â”‚   weight = f(likeIndex)   â”‚
â”‚   æ—©æœŸç‚¹èµæƒé‡æ›´é«˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è®°å½•ç‚¹èµä¿¡æ¯            â”‚
â”‚   ä¿å­˜ likeIndex, weight  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.6 é¢†å–å¥–åŠ±

#### ä½œè€…é¢†å–

```solidity
function claimAuthorReward(uint256 contentId) external nonReentrant {
    Content storage content = contents[contentId];

    // æ ¡éªŒ
    if (content.author != msg.sender) revert NotAuthor();
    if (block.timestamp < content.deadline) revert ContentNotExpired();
    if (content.authorClaimed) revert AlreadyClaimed();

    uint256 amount = content.authorPool;
    content.authorClaimed = true;

    if (amount > 0) {
        bloomToken.safeTransfer(msg.sender, amount);
    }

    emit AuthorRewardClaimed(contentId, msg.sender, amount);
}
```

#### ç‚¹èµè€…é¢†å–

```solidity
function claimLikerReward(uint256 contentId) external nonReentrant {
    Content storage content = contents[contentId];
    LikeInfo storage likeInfo = likes[contentId][msg.sender];

    // æ ¡éªŒ
    if (block.timestamp < content.deadline) revert ContentNotExpired();
    if (likeInfo.likeIndex == 0) revert NotLiked();
    if (likeInfo.claimed) revert AlreadyClaimed();

    likeInfo.claimed = true;

    // æ ¸å¿ƒè®¡ç®—ï¼šæŒ‰æƒé‡æ¯”ä¾‹åˆ†é…
    uint256 amount = 0;
    if (content.totalWeight > 0) {
        amount = (likeInfo.weight * content.likerRewardPool) / content.totalWeight;
    }

    if (amount > 0) {
        bloomToken.safeTransfer(msg.sender, amount);
    }

    emit LikerRewardClaimed(contentId, msg.sender, amount);
}
```

**ç‚¹èµè€…å¥–åŠ±è®¡ç®—å…¬å¼ï¼š**

```
ç”¨æˆ·å¥–åŠ± = (ç”¨æˆ·æƒé‡ / æ€»æƒé‡) Ã— ç‚¹èµè€…å¥–é‡‘æ± 
```

### 4.7 ç¤¾äº¤åŠŸèƒ½

```solidity
function follow(address followee) external {
    if (followee == msg.sender) revert CannotFollowSelf();
    if (isFollowing[msg.sender][followee]) revert AlreadyFollowing();

    isFollowing[msg.sender][followee] = true;
    emit Followed(msg.sender, followee);
}

function unfollow(address followee) external {
    if (!isFollowing[msg.sender][followee]) revert NotFollowing();

    isFollowing[msg.sender][followee] = false;
    emit Unfollowed(msg.sender, followee);
}
```

**è®¾è®¡è¯´æ˜ï¼š**
- å…³æ³¨æ•°æ®å­˜å‚¨åœ¨é“¾ä¸Šï¼ˆå»ä¸­å¿ƒåŒ–ï¼‰
- åªå­˜å‚¨å…³ç³»ï¼Œä¸å­˜å‚¨æ•°é‡ï¼ˆèŠ‚çœ gasï¼‰
- ç²‰ä¸æ•°é‡ç”±å‰ç«¯/indexer ç»Ÿè®¡

---

## 5. WeightLib æƒé‡è®¡ç®—åº“

### 5.1 è®¾è®¡ç›®çš„

å®ç° **"æ—©é¸Ÿæ¿€åŠ±"** æœºåˆ¶ï¼šè¶Šæ—©ç‚¹èµçš„ç”¨æˆ·ï¼Œè·å¾—çš„æƒé‡è¶Šé«˜ï¼Œæœ€ç»ˆåˆ†å¾—çš„å¥–åŠ±è¶Šå¤šã€‚

### 5.2 æƒé‡å…¬å¼

```
w(i) = 0.2 + 0.8 Ã— exp(-0.20 Ã— (i-1))
```

å…¶ä¸­ `i` æ˜¯ç‚¹èµé¡ºåºï¼ˆä»1å¼€å§‹ï¼‰ã€‚

### 5.3 æƒé‡æ›²çº¿

```
æƒé‡
 1.0 â”¤ â—
     â”‚  â—
 0.8 â”¤   â—
     â”‚    â—
 0.6 â”¤     â—
     â”‚       â—
 0.4 â”¤         â—â—
     â”‚            â—â—â—â—
 0.2 â”¤                 â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—
     â”‚
 0.0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         1   5   10  20  30  40  50  60  70+
                    ç‚¹èµé¡ºåº(i)
```

### 5.4 æƒé‡ç¤ºä¾‹

| ç‚¹èµé¡ºåº | æƒé‡ | è¯´æ˜ |
|---------|------|------|
| 1 | 1.0000 | ç¬¬ä¸€ä¸ªç‚¹èµè€…ï¼Œæƒé‡æœ€é«˜ |
| 2 | 0.8551 | å¿«é€Ÿä¸‹é™ |
| 5 | 0.5569 | |
| 10 | 0.3278 | |
| 20 | 0.2340 | |
| 50 | 0.2205 | è¶‹äºç¨³å®š |
| 72+ | 0.2000 | æœ€ä½æƒé‡ï¼ˆä¿åº•ï¼‰ |

### 5.5 å®ç°æ–¹å¼ï¼šæŸ¥æ‰¾è¡¨

```solidity
function calculateWeight(uint256 likeIndex) internal pure returns (uint256) {
    require(likeIndex > 0, "WeightLib: index must be positive");

    // ç¬¬1ä¸ªç‚¹èµï¼šæƒé‡ = 1.0
    if (likeIndex == 1) {
        return W_MAX;  // 1e18
    }

    // 2-100ï¼šä½¿ç”¨æŸ¥æ‰¾è¡¨ï¼ˆèŠ‚çœè®¡ç®—gasï¼‰
    if (likeIndex <= 100) {
        return _lookupWeight(likeIndex);
    }

    // >100ï¼šç›´æ¥è¿”å›æœ€å°æƒé‡
    return W_MIN;  // 0.2e18
}
```

**ä¸ºä»€ä¹ˆç”¨æŸ¥æ‰¾è¡¨ï¼Ÿ**
- Solidity ä¸æ”¯æŒæµ®ç‚¹æ•°è¿ç®—
- `exp()` å‡½æ•°è®¡ç®—æˆæœ¬é«˜
- é¢„è®¡ç®— + æŸ¥è¡¨å¯ä»¥å¤§å¹…èŠ‚çœ gas

### 5.6 ç²¾åº¦è¯´æ˜

æ‰€æœ‰æƒé‡å€¼éƒ½ä¹˜ä»¥ `10^18` å­˜å‚¨ï¼š

```solidity
uint256 private constant PRECISION = 1e18;
uint256 private constant W_MIN = 2e17;   // 0.2 Ã— 10^18
uint256 private constant W_MAX = 1e18;   // 1.0 Ã— 10^18
```

è¿™æ ·åšçš„å¥½å¤„ï¼š
- ä¿æŒé«˜ç²¾åº¦
- ä¸ ERC-20 ä»£å¸ç²¾åº¦ä¸€è‡´ï¼ˆé€šå¸¸ä¹Ÿæ˜¯18ä½å°æ•°ï¼‰

---

## 6. ç»æµæ¨¡å‹è¯¦è§£

### 6.1 èµ„é‡‘æµå‘å›¾

```
            ç”¨æˆ·ç‚¹èµæ”¯ä»˜ 100 BLOOM
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           BloomContent åˆçº¦           â”‚
    â”‚                                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ ä½œè€…æ±   â”‚ â”‚ ç‚¹èµæ±   â”‚ â”‚ åè®®è´¹  â”‚ â”‚
    â”‚  â”‚ 70 BLOOMâ”‚ â”‚ 25 BLOOMâ”‚ â”‚ 5 BLOOM â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
    â”‚       â”‚           â”‚           â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚           â”‚           â”‚
            â–¼           â–¼           â–¼
       ä½œè€…é¢†å–    ç‚¹èµè€…æŒ‰æƒé‡   å¹³å°æå–
                     æ¯”ä¾‹é¢†å–
```

### 6.2 æ”¶ç›Šè®¡ç®—ç¤ºä¾‹

å‡è®¾ä¸€ä¸ªå†…å®¹æœ‰ 3 ä¸ªç‚¹èµè€…ï¼Œæ¯æ¬¡ç‚¹èµ 100 BLOOMï¼š

| ç‚¹èµè€… | é¡ºåº | æ”¯ä»˜ | æƒé‡ |
|--------|------|------|------|
| Alice | 1 | 100 | 1.0000 |
| Bob | 2 | 100 | 0.8551 |
| Carol | 3 | 100 | 0.7358 |

**è®¡ç®—è¿‡ç¨‹ï¼š**

```
æ€»ç‚¹èµé‡‘é¢ = 300 BLOOM

ä½œè€…æ±  = 300 Ã— 70% = 210 BLOOM
ç‚¹èµæ±  = 300 Ã— 25% = 75 BLOOM
åè®®è´¹ = 300 Ã— 5% = 15 BLOOM

æ€»æƒé‡ = 1.0 + 0.8551 + 0.7358 = 2.5909

Alice å¥–åŠ± = 75 Ã— (1.0 / 2.5909) = 28.96 BLOOM
Bob å¥–åŠ±   = 75 Ã— (0.8551 / 2.5909) = 24.75 BLOOM
Carol å¥–åŠ± = 75 Ã— (0.7358 / 2.5909) = 21.29 BLOOM
```

**æ”¶ç›Šåˆ†æï¼š**

| å‚ä¸è€… | æ”¯å‡º | æ”¶å…¥ | å‡€æ”¶ç›Š |
|--------|------|------|--------|
| ä½œè€… | 0 | 210 | +210 |
| Alice | 100 | 28.96 | -71.04 |
| Bob | 100 | 24.75 | -75.25 |
| Carol | 100 | 21.29 | -78.71 |
| å¹³å° | 0 | 15 | +15 |

### 6.3 ç»æµæ¨¡å‹ç‰¹ç‚¹

1. **ä½œè€…æ¿€åŠ±**ï¼šä½œè€…è·å¾—å¤§éƒ¨åˆ†æ”¶ç›Šï¼Œé¼“åŠ±ä¼˜è´¨å†…å®¹åˆ›ä½œ
2. **æ—©é¸Ÿæ¿€åŠ±**ï¼šæ—©æœŸç‚¹èµè€…åˆ†å¾—æ›´å¤šå¥–åŠ±ï¼Œæ¿€åŠ±å¿«é€Ÿå‘ç°å¥½å†…å®¹
3. **å¹³å°å¯æŒç»­**ï¼š5% åè®®è´¹æ”¯æŒå¹³å°è¿è¥
4. **ç‚¹èµè€…æ˜¯"æŠ•èµ„è€…"**ï¼šç‚¹èµéœ€è¦ä»˜å‡ºä»£å¸ï¼Œä½†å¯ä»¥è·å¾—åˆ†çº¢

---

## 7. å®Œæ•´æµç¨‹ç¤ºä¾‹

### 7.1 åœºæ™¯è®¾å®š

- ä½œè€… Alice å‘å¸ƒä¸€ç¯‡æ–‡ç« 
- ç”¨æˆ· Bobã€Carolã€Dave ä¾æ¬¡ç‚¹èµ
- æˆªæ­¢åå„æ–¹é¢†å–å¥–åŠ±

### 7.2 æ“ä½œæµç¨‹

```solidity
// 1ï¸âƒ£ Alice åˆ›å»ºå†…å®¹
BloomContent.createContent(
    100 * 1e18,        // ç‚¹èµä»·æ ¼ï¼š100 BLOOM
    7 days,            // æŒç»­æ—¶é—´ï¼š7å¤©
    "ipfs://Qm...",    // å†…å®¹IPFSåœ°å€
    keccak256("...")   // å†…å®¹å“ˆå¸Œ
);
// è¿”å› contentId = 0

// 2ï¸âƒ£ Bob ç‚¹èµï¼ˆéœ€è¦å…ˆ approveï¼‰
BloomToken.approve(BloomContent.address, 100 * 1e18);
BloomContent.like(0);
// Bob æˆä¸ºç¬¬1ä¸ªç‚¹èµè€…ï¼Œæƒé‡ = 1.0

// 3ï¸âƒ£ Carol ç‚¹èµ
BloomToken.approve(BloomContent.address, 100 * 1e18);
BloomContent.like(0);
// Carol æˆä¸ºç¬¬2ä¸ªç‚¹èµè€…ï¼Œæƒé‡ = 0.8551

// 4ï¸âƒ£ Dave ç‚¹èµ
BloomToken.approve(BloomContent.address, 100 * 1e18);
BloomContent.like(0);
// Dave æˆä¸ºç¬¬3ä¸ªç‚¹èµè€…ï¼Œæƒé‡ = 0.7358

// â° ç­‰å¾… 7 å¤©å...

// 5ï¸âƒ£ Alice é¢†å–ä½œè€…å¥–åŠ±
BloomContent.claimAuthorReward(0);
// Alice è·å¾— 210 BLOOM

// 6ï¸âƒ£ Bob é¢†å–ç‚¹èµå¥–åŠ±
BloomContent.claimLikerReward(0);
// Bob è·å¾— 28.96 BLOOM

// 7ï¸âƒ£ Carol é¢†å–ç‚¹èµå¥–åŠ±
BloomContent.claimLikerReward(0);
// Carol è·å¾— 24.75 BLOOM

// 8ï¸âƒ£ Dave é¢†å–ç‚¹èµå¥–åŠ±
BloomContent.claimLikerReward(0);
// Dave è·å¾— 21.29 BLOOM

// 9ï¸âƒ£ å¹³å°æå–åè®®è´¹
BloomContent.withdrawProtocolFee();
// å¹³å°è·å¾— 15 BLOOM
```

---

## 8. å®‰å…¨è€ƒè™‘

### 8.1 é‡å…¥æ”»å‡»é˜²æŠ¤

```solidity
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";

contract BloomContent is ReentrancyGuard {
    function like(uint256 contentId) external nonReentrant {
        // ...
    }
}
```

`nonReentrant` ä¿®é¥°ç¬¦ç¡®ä¿å‡½æ•°æ‰§è¡ŒæœŸé—´ä¸èƒ½è¢«é‡å¤è°ƒç”¨ã€‚

### 8.2 å®‰å…¨ä»£å¸è½¬è´¦

```solidity
using SafeERC20 for IERC20;

// ä½¿ç”¨ safeTransferFrom è€Œé transferFrom
bloomToken.safeTransferFrom(msg.sender, address(this), amount);
```

`SafeERC20` ä¼šæ£€æŸ¥è¿”å›å€¼ï¼Œå¤„ç†ä¸è§„èŒƒçš„ ERC-20 ä»£å¸ã€‚

### 8.3 è‡ªå®šä¹‰é”™è¯¯ï¼ˆèŠ‚çœ Gasï¼‰

```solidity
error ContentNotFound();
error ContentExpired();
error AlreadyLiked();

// ä½¿ç”¨
if (content.author == address(0)) revert ContentNotFound();
```

ç›¸æ¯” `require(condition, "message")`ï¼š
- èŠ‚çœ gasï¼ˆä¸éœ€è¦å­˜å‚¨é”™è¯¯å­—ç¬¦ä¸²ï¼‰
- æ›´ç»“æ„åŒ–

### 8.4 æ•´æ•°æº¢å‡ºä¿æŠ¤

Solidity 0.8.x å†…ç½®äº†æº¢å‡ºæ£€æŸ¥ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚

### 8.5 æ—¶é—´æˆ³ä¾èµ–

```solidity
if (block.timestamp >= content.deadline) revert ContentExpired();
```

`block.timestamp` å¯è¢«çŸ¿å·¥å°å¹…æ“æ§ï¼ˆçº¦15ç§’ï¼‰ï¼Œä½†å¯¹äºå¤©çº§åˆ«çš„æˆªæ­¢æ—¶é—´å½±å“å¯ä»¥å¿½ç•¥ã€‚

---

## æ€»ç»“

BloomSocial åˆçº¦ç³»ç»Ÿå±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„ Web3 ç¤¾äº¤å¹³å°å®ç°ï¼š

| ç‰¹æ€§ | å®ç°æ–¹å¼ |
|------|----------|
| ä»£å¸ç»æµ | ERC-20 æ ‡å‡†ä»£å¸ |
| å†…å®¹ç®¡ç† | ç»“æ„ä½“ + æ˜ å°„å­˜å‚¨ |
| æ¿€åŠ±æœºåˆ¶ | 70/25/5 åˆ†æˆ + æƒé‡è¡°å‡ |
| å®‰å…¨é˜²æŠ¤ | ReentrancyGuard + SafeERC20 |
| ç¤¾äº¤å…³ç³» | é“¾ä¸Šæ˜ å°„å­˜å‚¨ |

**å­¦ä¹ å»ºè®®ï¼š**
1. å…ˆç†è§£æ•´ä½“æ¶æ„å’Œèµ„é‡‘æµå‘
2. é€ä¸ªå‡½æ•°é˜…è¯»ï¼Œç†è§£æ¯ä¸€æ­¥çš„ä½œç”¨
3. è‡ªå·±éƒ¨ç½²åˆ°æµ‹è¯•ç½‘å®é™…æ“ä½œä¸€é
4. å°è¯•ä¿®æ”¹å‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœå˜åŒ–

ç¥å­¦ä¹ é¡ºåˆ©ï¼ ğŸš€
